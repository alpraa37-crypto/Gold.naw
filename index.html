// تأكد من أن جميع العناصر موجودة
document.addEventListener('DOMContentLoaded', function() {
    console.log('بدء تحميل التطبيق...');
    
    try {
        // كود التطبيق هنا
        initApp();
    } catch (error) {
        console.error('خطأ في التطبيق:', error);
        alert('حدث خطأ في التطبيق: ' + error.message);
    }
});

// الأسعار الحقيقية
let goldPrices = {
    EGP: {
        k24: 6523.57,
        k22: 5979.94,
        k21: 5708.13,
        k18: 4892.68,
        gram: 6523.57,
        ounce: 202883.12
    }
};

function initApp() {
    console.log('تهيئة التطبيق...');
    
    // تحديث التاريخ
    const now = new Date();
    document.getElementById('current-date').textContent = now.toLocaleDateString('ar-EG');
    
    // تحميل الأسعار
    loadGoldPrices();
    
    // إعداد الأحداث
    document.getElementById('refresh-btn').addEventListener('click', refreshPrices);
    document.getElementById('calculate-btn').addEventListener('click', calculateGoldPrice);
    
    console.log('التطبيق جاهز!');
}

function loadGoldPrices() {
    try {
        document.getElementById('k24-price').textContent = `ج.م ${goldPrices.EGP.k24.toLocaleString()}`;
        document.getElementById('k22-price').textContent = `ج.م ${goldPrices.EGP.k22.toLocaleString()}`;
        document.getElementById('k21-price').textContent = `ج.م ${goldPrices.EGP.k21.toLocaleString()}`;
        document.getElementById('k18-price').textContent = `ج.م ${goldPrices.EGP.k18.toLocaleString()}`;
        document.getElementById('ounce-price').textContent = `ج.م ${goldPrices.EGP.ounce.toLocaleString()}`;
        document.getElementById('gram-price').textContent = `ج.م ${goldPrices.EGP.gram.toLocaleString()}`;
        
        calculateGoldPrice();
        updateLastUpdateTime();
        
    } catch (error) {
        console.error('خطأ في تحميل الأسعار:', error);
    }
}

function calculateGoldPrice() {
    try {
        const weight = parseFloat(document.getElementById('weight').value) || 1;
        const karat = parseInt(document.getElementById('karat').value);
        const gram24Price = goldPrices.EGP.k24;
        
        let pricePerGram;
        switch (karat) {
            case 24: pricePerGram = gram24Price; break;
            case 22: pricePerGram = gram24Price * 0.9167; break;
            case 21: pricePerGram = gram24Price * 0.875; break;
            case 18: pricePerGram = gram24Price * 0.75; break;
            case 14: pricePerGram = gram24Price * 0.583; break;
            default: pricePerGram = gram24Price;
        }
        
        const totalPrice = weight * pricePerGram;
        document.getElementById('calc-result').textContent = `ج.م ${totalPrice.toLocaleString()}`;
        
    } catch (error) {
        console.error('خطأ في الحاسبة:', error);
    }
}

function refreshPrices() {
    console.log('تحديث الأسعار...');
    // كود التحديث هنا
}

function updateLastUpdateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('ar-EG');
    document.getElementById('last-update').textContent = timeString;
    document.getElementById('footer-update').textContent = timeString;
}
